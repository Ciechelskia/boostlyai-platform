<!DOCTYPE html>
<html lang="fr">
<head>
    <base href="./">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="MEETIA - Transcription intelligente de réunions avec IA">
  <meta name="theme-color" content="#7C3AED">
  
  <title>Connexion - MEETIA</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="assets/images/favicon.svg">
  
  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/login.css">
  
  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="login-container">
    <div class="login-card">
      <!-- Header avec logo -->
      <div class="login-header">
        <div class="login-logo">
          <!-- SVG icône microphone -->
          <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
            <line x1="12" y1="19" x2="12" y2="22"></line>
          </svg>
        </div>
        <h1 class="login-title">MEETIA</h1>
        <p class="login-subtitle">Transformez vos réunions en insights exploitables</p>
      </div>
      
      <!-- Message d'erreur / succès -->
      <div id="loginMessage" class="login-message"></div>
      
      <!-- Tabs Login / Signup -->
      <div class="login-tabs">
        <div class="login-tab active" data-tab="signin">
          Connexion
        </div>
        <div class="login-tab" data-tab="signup">
          Inscription
        </div>
      </div>
      
      <!-- Formulaire de Connexion -->
      <div id="signinForm" class="form-section active">
        <form id="loginForm" class="login-form">
          <div class="input-group">
            <label class="input-label" for="signin-email">
              Email <span class="required">*</span>
            </label>
            <input 
              type="email" 
              id="signin-email" 
              class="input" 
              placeholder="votre@email.com"
              required
              autocomplete="email"
            >
          </div>
          
          <div class="input-group">
            <label class="input-label" for="signin-password">
              Mot de passe <span class="required">*</span>
            </label>
            <input 
              type="password" 
              id="signin-password" 
              class="input" 
              placeholder="••••••••"
              required
              autocomplete="current-password"
            >
          </div>
          
          <div class="login-links">
            <label class="remember-me">
              <input type="checkbox" id="remember-me">
              <span>Se souvenir de moi</span>
            </label>
            <a href="#" id="forgotPasswordLink">Mot de passe oublié ?</a>
          </div>
          
          <button type="submit" class="btn btn-primary btn-full login-submit">
            Se connecter
          </button>
        </form>
        
        <div class="login-divider">
          <span>OU</span>
        </div>
        
        <div class="oauth-buttons">
          <button type="button" class="btn-oauth" id="googleSignInBtn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19.99 10.187c0-.82-.069-1.417-.216-2.037H10.2v3.698h5.62c-.113.92-.725 2.303-2.084 3.233l-.02.124 3.028 2.292.21.02c1.926-1.738 3.037-4.296 3.037-7.33z" fill="#4285F4"/>
              <path d="M10.2 19.931c2.753 0 5.064-.886 6.753-2.414l-3.218-2.436c-.862.587-2.017.997-3.536.997a6.126 6.126 0 01-5.801-4.141l-.12.01-3.148 2.38-.041.112c1.677 3.256 5.122 5.492 9.11 5.492z" fill="#34A853"/>
              <path d="M4.397 11.937a6.008 6.008 0 01-.34-1.971c0-.687.125-1.351.329-1.971l-.006-.132-3.188-2.42-.104.05A9.79 9.79 0 000 9.965a9.79 9.79 0 001.088 4.473l3.309-2.502z" fill="#FBBC05"/>
              <path d="M10.2 3.853c1.914 0 3.206.809 3.943 1.484l2.878-2.746C15.253.985 12.953 0 10.199 0 6.211 0 2.766 2.237 1.09 5.492l3.297 2.503A6.152 6.152 0 0110.2 3.853z" fill="#EB4335"/>
            </svg>
            Continuer avec Google
          </button>
        </div>
      </div>
      
      <!-- Formulaire d'Inscription -->
      <div id="signupForm" class="form-section">
        <form id="registerForm" class="login-form">
          <div class="input-group">
            <label class="input-label" for="signup-name">
              Nom complet <span class="required">*</span>
            </label>
            <input 
              type="text" 
              id="signup-name" 
              class="input" 
              placeholder="Jean Dupont"
              required
              autocomplete="name"
            >
          </div>
          
          <div class="input-group">
            <label class="input-label" for="signup-email">
              Email <span class="required">*</span>
            </label>
            <input 
              type="email" 
              id="signup-email" 
              class="input" 
              placeholder="votre@email.com"
              required
              autocomplete="email"
            >
          </div>
          
          <div class="input-group">
            <label class="input-label" for="signup-password">
              Mot de passe <span class="required">*</span>
            </label>
            <input 
              type="password" 
              id="signup-password" 
              class="input" 
              placeholder="••••••••"
              required
              autocomplete="new-password"
              minlength="6"
            >
            <small class="input-help">Minimum 6 caractères</small>
          </div>
          
          <div class="input-group">
            <label class="input-label" for="signup-password-confirm">
              Confirmer le mot de passe <span class="required">*</span>
            </label>
            <input 
              type="password" 
              id="signup-password-confirm" 
              class="input" 
              placeholder="••••••••"
              required
              autocomplete="new-password"
              minlength="6"
            >
          </div>
          
          <label class="checkbox-wrapper">
            <input type="checkbox" id="terms-accept" required>
            <span class="text-sm">
              J'accepte les <a href="#" class="text-accent">conditions d'utilisation</a> et la <a href="#" class="text-accent">politique de confidentialité</a>
            </span>
          </label>
          
          <button type="submit" class="btn btn-primary btn-full login-submit">
            Créer mon compte
          </button>
        </form>
        
        <div class="login-divider">
          <span>OU</span>
        </div>
        
        <div class="oauth-buttons">
          <button type="button" class="btn-oauth" id="googleSignUpBtn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19.99 10.187c0-.82-.069-1.417-.216-2.037H10.2v3.698h5.62c-.113.92-.725 2.303-2.084 3.233l-.02.124 3.028 2.292.21.02c1.926-1.738 3.037-4.296 3.037-7.33z" fill="#4285F4"/>
              <path d="M10.2 19.931c2.753 0 5.064-.886 6.753-2.414l-3.218-2.436c-.862.587-2.017.997-3.536.997a6.126 6.126 0 01-5.801-4.141l-.12.01-3.148 2.38-.041.112c1.677 3.256 5.122 5.492 9.11 5.492z" fill="#34A853"/>
              <path d="M4.397 11.937a6.008 6.008 0 01-.34-1.971c0-.687.125-1.351.329-1.971l-.006-.132-3.188-2.42-.104.05A9.79 9.79 0 000 9.965a9.79 9.79 0 001.088 4.473l3.309-2.502z" fill="#FBBC05"/>
              <path d="M10.2 3.853c1.914 0 3.206.809 3.943 1.484l2.878-2.746C15.253.985 12.953 0 10.199 0 6.211 0 2.766 2.237 1.09 5.492l3.297 2.503A6.152 6.152 0 0110.2 3.853z" fill="#EB4335"/>
            </svg>
            S'inscrire avec Google
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Scripts -->
  <script src="js/config.js"></script>
  <script src="js/supabase-client.js"></script>
  <script src="js/auth.js"></script>
  <script>
    // ===================================
    // Script de la page login
    // ===================================
    
    document.addEventListener('DOMContentLoaded', async () => {
      // Vérifier si déjà authentifié
      await redirectIfAuthenticated();
      
      // === GESTION DES TABS ===
      const tabs = document.querySelectorAll('.login-tab');
      const signinForm = document.getElementById('signinForm');
      const signupForm = document.getElementById('signupForm');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.dataset.tab;
          
          // Changer l'onglet actif
          tabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          // Afficher le bon formulaire
          if (tabName === 'signin') {
            signinForm.classList.add('active');
            signupForm.classList.remove('active');
          } else {
            signupForm.classList.add('active');
            signinForm.classList.remove('active');
          }
          
          // Cacher les messages
          hideMessage();
        });
      });
      
      // === FORMULAIRE DE CONNEXION ===
      const loginForm = document.getElementById('loginForm');
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = document.getElementById('signin-email').value;
        const password = document.getElementById('signin-password').value;
        
        // Loading state
        loginForm.classList.add('loading');
        hideMessage();
        
        // Connexion
        const result = await signIn(email, password);
        
        loginForm.classList.remove('loading');
        
        if (result.success) {
          showMessage('Connexion réussie ! Redirection...', 'success');
          setTimeout(() => {
            window.location.href = './app.html';
          }, 1000);
        } else {
          showMessage(result.error || 'Erreur de connexion. Vérifiez vos identifiants.', 'error');
        }
      });
      
      // === FORMULAIRE D'INSCRIPTION ===
      const registerForm = document.getElementById('registerForm');
      registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const name = document.getElementById('signup-name').value;
        const email = document.getElementById('signup-email').value;
        const password = document.getElementById('signup-password').value;
        const passwordConfirm = document.getElementById('signup-password-confirm').value;
        
        // Vérifier que les mots de passe correspondent
        if (password !== passwordConfirm) {
          showMessage('Les mots de passe ne correspondent pas.', 'error');
          return;
        }
        
        // Loading state
        registerForm.classList.add('loading');
        hideMessage();
        
        // Inscription
        const result = await signUp(email, password, name);
        
        registerForm.classList.remove('loading');
        
        if (result.success) {
          showMessage('Compte créé ! Vérifiez votre email pour confirmer votre adresse.', 'success');
          // Optionnel : rediriger après quelques secondes
          setTimeout(() => {
            // Switcher vers l'onglet connexion
            tabs[0].click();
          }, 3000);
        } else {
          showMessage(result.error || 'Erreur lors de l\'inscription.', 'error');
        }
      });
      
      // === GOOGLE OAUTH ===
      document.getElementById('googleSignInBtn').addEventListener('click', async () => {
        await signInWithGoogle();
      });
      
      document.getElementById('googleSignUpBtn').addEventListener('click', async () => {
        await signInWithGoogle();
      });
      
      // === MOT DE PASSE OUBLIÉ ===
      document.getElementById('forgotPasswordLink').addEventListener('click', async (e) => {
        e.preventDefault();
        
        const email = prompt('Entrez votre adresse email pour réinitialiser votre mot de passe :');
        
        if (email) {
          const result = await resetPassword(email);
          
          if (result.success) {
            showMessage('Email de réinitialisation envoyé ! Vérifiez votre boîte de réception.', 'success');
          } else {
            showMessage(result.error || 'Erreur lors de l\'envoi de l\'email.', 'error');
          }
        }
      });
    });
    
    // === FONCTIONS UTILITAIRES ===
    function showMessage(text, type = 'error') {
      const messageEl = document.getElementById('loginMessage');
      messageEl.textContent = text;
      messageEl.className = `login-message show ${type}`;
    }
    
    function hideMessage() {
      const messageEl = document.getElementById('loginMessage');
      messageEl.className = 'login-message';
    }
  </script>
</body>
</html>